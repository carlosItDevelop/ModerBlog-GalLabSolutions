@model IEnumerable<ModernBlog.Models.Post>
@{
    ViewData["Title"] = "Início";
    var featuredPosts = ViewBag.FeaturedPosts as IEnumerable<ModernBlog.Models.Post>;
    var recentPosts = ViewBag.RecentPosts as IEnumerable<ModernBlog.Models.Post>;
    var categories = ViewBag.Categories as IEnumerable<ModernBlog.Models.Category>;
    var currentPage = (int)ViewBag.CurrentPage;
    var totalPages = (int)ViewBag.TotalPages;
}

<div class="container py-4">
    <!-- Featured Posts Carousel -->
    @if (featuredPosts?.Any() == true)
    {
        <div id="featuredCarousel" class="carousel slide mb-5" data-bs-ride="carousel">
            <div class="carousel-indicators">
                @{int index = 0;}
                @foreach (var post in featuredPosts)
                {
                    <button type="button" data-bs-target="#featuredCarousel" data-bs-slide-to="@index" 
                            class="@(index == 0 ? "active" : "")" aria-current="@(index == 0 ? "true" : "false")"></button>
                    index++;
                }
            </div>
            <div class="carousel-inner">
                @{index = 0;}
                @foreach (var post in featuredPosts)
                {
                    <div class="carousel-item @(index == 0 ? "active" : "")">
                        <div class="card bg-dark text-white">
                            @if (!string.IsNullOrEmpty(post.FeaturedImageUrl))
                            {
                                <img src="@post.FeaturedImageUrl" class="card-img" alt="@post.Title" style="height: 400px; object-fit: cover;">
                                <div class="card-img-overlay d-flex align-items-end">
                                    <div class="w-100">
                                        <h5 class="card-title">@post.Title</h5>
                                        <p class="card-text">@post.Summary</p>
                                        <a href="/Home/Post?slug=@post.Slug" class="btn btn-primary">Ler mais</a>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="card-body">
                                    <h5 class="card-title">@post.Title</h5>
                                    <p class="card-text">@post.Summary</p>
                                    <a href="/Home/Post?slug=@post.Slug" class="btn btn-primary">Ler mais</a>
                                </div>
                            }
                        </div>
                    </div>
                    index++;
                }
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
        </div>
    }

    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <h2 class="mb-4">Posts Recentes</h2>

            @if (Model?.Any() == true)
            {
                <div class="row">
                    @foreach (var post in Model)
                    {
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                @if (!string.IsNullOrEmpty(post.FeaturedImageUrl))
                                {
                                    <img src="@post.FeaturedImageUrl" class="card-img-top" alt="@post.Title" style="height: 200px; object-fit: cover;">
                                }
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">@post.Title</h5>
                                    <p class="card-text flex-grow-1">@post.Summary</p>

                                    <div class="mb-2">
                                        <span class="badge bg-primary">@post.Category?.Name</span>
                                        @foreach (var postTag in post.PostTags)
                                        {
                                            <span class="badge bg-secondary">@postTag.Tag.Name</span>
                                        }
                                    </div>

                                    <div class="d-flex justify-content-between align-items-center text-muted small mb-2">
                                        <span>Por @post.Author?.FullName</span>
                                        <span>@post.PublishedAt?.ToString("dd/MM/yyyy")</span>
                                    </div>

                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <i class="bi bi-eye"></i> @post.ViewCount
                                            <i class="bi bi-heart ms-2"></i> @post.LikeCount
                                        </div>
                                        <a href="/Home/Post?slug=@post.Slug" class="btn btn-outline-primary btn-sm">Ler mais</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- Pagination -->
                @if (totalPages > 1)
                {
                    <nav>
                        <ul class="pagination justify-content-center">
                            @if (currentPage > 1)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Index", new { page = currentPage - 1 })">Anterior</a>
                                </li>
                            }

                            @for (int i = Math.Max(1, currentPage - 2); i <= Math.Min(totalPages, currentPage + 2); i++)
                            {
                                <li class="page-item @(i == currentPage ? "active" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>
                                </li>
                            }

                            @if (currentPage < totalPages)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Index", new { page = currentPage + 1 })">Próxima</a>
                                </li>
                            }
                        </ul>
                    </nav>
                }
            }
            else
            {
                <div class="text-center py-5">
                    <i class="bi bi-journal-x display-1 text-muted"></i>
                    <h3 class="text-muted">Nenhum post encontrado</h3>
                    <p class="text-muted">Volte mais tarde para ver novos conteúdos!</p>
                </div>
            }
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Login Section -->
            @if (User.Identity?.IsAuthenticated != true)
            {
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="bi bi-person-circle"></i> Acesso</h5>
                    </div>
                    <div class="card-body">
                        <p>Faça login para comentar nos posts e interagir com a comunidade.</p>
                        <a href="@Url.Page("/Account/Login", new { area = "Identity" })" class="btn btn-primary btn-sm me-2">Entrar</a>
                        <a href="@Url.Page("/Account/Register", new { area = "Identity" })" class="btn btn-outline-primary btn-sm">Registrar</a>
                    </div>
                </div>
            }

            <!-- Recent Posts -->
            @if (recentPosts?.Any() == true)
            {
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="bi bi-clock"></i> Posts Recentes</h5>
                    </div>
                    <div class="card-body">
                        @foreach (var post in recentPosts.Take(5))
                        {
                            <div class="d-flex mb-3">
                                @if (!string.IsNullOrEmpty(post.FeaturedImageUrl))
                                {
                                    <img src="@post.FeaturedImageUrl" alt="@post.Title" class="me-3" style="width: 60px; height: 60px; object-fit: cover;">
                                }
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">
                                        <a href="/Home/Post?slug=@post.Slug" class="text-decoration-none">@post.Title</a>
                                    </h6>
                                    <small class="text-muted">@post.PublishedAt?.ToString("dd/MM/yyyy")</small>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Categories -->
            @if (categories?.Any() == true)
            {
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="bi bi-folder"></i> Categorias</h5>
                    </div>
                    <div class="card-body">
                        @foreach (var category in categories)
                        {
                            <a href="@Url.Action("Category", "Home", new { id = category.Id })" 
                               class="badge me-2 mb-2 text-decoration-none" 
                               style="background-color: @category.Color">
                                @category.Name
                            </a>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>