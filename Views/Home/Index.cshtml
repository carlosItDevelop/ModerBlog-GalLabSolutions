
@model IEnumerable<ModernBlog.Models.Post>
@{
    ViewData["Title"] = "Home";
    var featuredPosts = ViewBag.FeaturedPosts as IEnumerable<ModernBlog.Models.Post>;
    var recentPosts = ViewBag.RecentPosts as IEnumerable<ModernBlog.Models.Post>;
    var mostViewedPosts = ViewBag.MostViewedPosts as IEnumerable<ModernBlog.Models.Post>;
    var categories = ViewBag.Categories as IEnumerable<ModernBlog.Models.Category>;
}

<!-- Featured Posts Carousel -->
@if (featuredPosts?.Any() == true)
{
    <div id="featuredCarousel" class="carousel slide mb-5" data-bs-ride="carousel">
        <div class="carousel-indicators">
            @for (int i = 0; i < featuredPosts.Count(); i++)
            {
                <button type="button" data-bs-target="#featuredCarousel" data-bs-slide-to="@i" 
                        class="@(i == 0 ? "active" : "")" aria-current="@(i == 0 ? "true" : "false")"></button>
            }
        </div>
        <div class="carousel-inner">
            @foreach (var (post, index) in featuredPosts.Select((post, index) => (post, index)))
            {
                <div class="carousel-item @(index == 0 ? "active" : "")">
                    <div class="position-relative">
                        <img src="/@(post.FeaturedImageUrl ?? "images/default-post.jpg")" 
                             class="d-block w-100" style="height: 400px; object-fit: cover;" alt="@post.Title">
                        <div class="carousel-caption d-none d-md-block">
                            <div class="bg-dark bg-opacity-75 p-3 rounded">
                                <h5>@post.Title</h5>
                                <p>@post.Summary</p>
                                <a href="@Url.Action("Post", "Home", new { slug = post.Slug })" 
                                   class="btn btn-primary">Ler mais</a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>
}

<div class="container">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <h2 class="mb-4">Posts Recentes</h2>
            
            <div class="row">
                @foreach (var post in Model)
                {
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            @if (!string.IsNullOrEmpty(post.FeaturedImageUrl))
                            {
                                <img src="/@post.FeaturedImageUrl" class="card-img-top" 
                                     style="height: 200px; object-fit: cover;" alt="@post.Title">
                            }
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">@post.Title</h5>
                                <p class="card-text flex-grow-1">@post.Summary</p>
                                
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">
                                        <i class="bi bi-person me-1"></i>@post.Author.FullName
                                    </small>
                                    <small class="text-muted">
                                        <i class="bi bi-calendar me-1"></i>@post.PublishedAt?.ToString("dd/MM/yyyy")
                                    </small>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span class="badge" style="background-color: @post.Category.Color">
                                        @post.Category.Name
                                    </span>
                                    <div>
                                        <span class="text-muted me-3">
                                            <i class="bi bi-eye me-1"></i>@post.ViewCount
                                        </span>
                                        <span class="text-muted">
                                            <i class="bi bi-heart me-1"></i>@post.LikeCount
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="mb-2">
                                    @foreach (var postTag in post.PostTags.Take(3))
                                    {
                                        <span class="badge bg-secondary me-1">@postTag.Tag.Name</span>
                                    }
                                </div>
                                
                                <a href="@Url.Action("Post", "Home", new { slug = post.Slug })" 
                                   class="btn btn-primary mt-auto">Ler mais</a>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Pagination -->
            @if (ViewBag.TotalPages > 1)
            {
                <nav>
                    <ul class="pagination justify-content-center">
                        @if (ViewBag.CurrentPage > 1)
                        {
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.CurrentPage - 1 })">
                                    Anterior
                                </a>
                            </li>
                        }
                        
                        @for (int i = 1; i <= ViewBag.TotalPages; i++)
                        {
                            <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                                <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>
                            </li>
                        }
                        
                        @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                        {
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.CurrentPage + 1 })">
                                    Próxima
                                </a>
                            </li>
                        }
                    </ul>
                </nav>
            }
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Login Area -->
            @if (User.Identity?.IsAuthenticated != true)
            {
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-person-circle me-2"></i>Login</h5>
                    </div>
                    <div class="card-body">
                        <p>Faça login para comentar nos posts.</p>
                        <a href="/Identity/Account/Login" class="btn btn-primary me-2">Entrar</a>
                        <a href="/Identity/Account/Register" class="btn btn-outline-primary">Registrar</a>
                    </div>
                </div>
            }

            <!-- Recent Posts -->
            @if (recentPosts?.Any() == true)
            {
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-clock me-2"></i>Posts Recentes</h5>
                    </div>
                    <div class="card-body">
                        @foreach (var post in recentPosts)
                        {
                            <div class="d-flex mb-3">
                                @if (!string.IsNullOrEmpty(post.FeaturedImageUrl))
                                {
                                    <img src="/@post.FeaturedImageUrl" class="me-3" 
                                         style="width: 60px; height: 60px; object-fit: cover;" alt="@post.Title">
                                }
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">
                                        <a href="@Url.Action("Post", "Home", new { slug = post.Slug })" 
                                           class="text-decoration-none">@post.Title</a>
                                    </h6>
                                    <small class="text-muted">@post.PublishedAt?.ToString("dd/MM/yyyy")</small>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Categories -->
            @if (categories?.Any() == true)
            {
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-tags me-2"></i>Categorias</h5>
                    </div>
                    <div class="card-body">
                        @foreach (var category in categories)
                        {
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <a href="@Url.Action("Category", "Home", new { id = category.Id })" 
                                   class="text-decoration-none">
                                    <span class="badge me-2" style="background-color: @category.Color">
                                        @category.Name
                                    </span>
                                </a>
                                <span class="text-muted">(@category.Posts.Count(p => p.IsPublished))</span>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Most Viewed Posts -->
            @if (mostViewedPosts?.Any() == true)
            {
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-eye me-2"></i>Mais Visualizados</h5>
                    </div>
                    <div class="card-body">
                        @foreach (var post in mostViewedPosts)
                        {
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <a href="@Url.Action("Post", "Home", new { slug = post.Slug })" 
                                   class="text-decoration-none flex-grow-1">@post.Title</a>
                                <span class="text-muted ms-2">
                                    <i class="bi bi-eye me-1"></i>@post.ViewCount
                                </span>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>
